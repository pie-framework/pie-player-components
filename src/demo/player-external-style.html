<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
  />
  <title>Item With Stimulus</title>
  <script nomodule src="/build/pie-player-components.js"></script>
  <script type="module" src="/build/pie-player-components.esm.js"></script>
</head>
<body>
<div>
  <pie-player
    render-stimulus="false"
    classname="ibx-client-style"
    external-style-url="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.min.css"
  ></pie-player>
</div>

<script type="text/javascript" src="./utils/models.js"></script>
<script>
  const config = {
    'pie': {
      'models': [
        {
          choiceMode: 'checkbox',
          choicePrefix: 'numbers',
          choices: [
            {
              correct: true,
              value: 'sweden',
              label: 'Sweden',
              feedback: {
                type: 'none',
                value: '',
              },
            },
            {
              value: 'iceland',
              label: 'Iceland',
              feedback: {
                type: 'none',
                value: '',
              },
              rationale: 'Rationale for Iceland',
            },
            {
              value: 'norway',
              label: 'Norway',
              feedback: {
                type: 'none',
                value: '',
              },
              rationale: 'Rationale for Norway',
            },
            {
              correct: true,
              value: 'finland',
              label: 'Finland',
              feedback: {
                type: 'none',
                value: '',
              },
              rationale: 'Rationale for Finland',
            },
          ],
          prompt: 'Which of these northern European countries are EU members?',
          promptEnabled: true,
          toolbarEditorPosition: 'bottom',
          rubricEnabled: false,
          'element': 'multiple-choice',
          'id': '1'
        }
      ],
      'elements': {
        'multiple-choice': '@pie-element/multiple-choice@9.14.1-next.4'
      },
      'id': '1',
      'markup': '<multiple-choice id="1"></multiple-choice>',
      'bundle': {
        'url': [
          'https://pits-dot-pie-prod-221718.appspot.com/bundles/@pie-element/multiple-choice@9.14.1-next.4/player.js'
        ]
      }
    },
  };

  // function scopeCSS(cssText, scopeSelector = 'pie-player.ibx-client-style') {
  //   return cssText.replace(/(^|\})\s*([^{]+)\s*\{/g, (_, close, selector) => {
  //     const scoped = selector
  //       .split(',')
  //       .map(s => `${scopeSelector} ${s.trim()}`)
  //       .join(', ');
  //     return `${close} ${scoped} {`;
  //   });
  // }
  //
  // async function loadScopedExternalStyle(url, scopeSelector) {
  //   const res = await fetch(url);
  //   const css = await res.text();
  //   const scopedCSS = scopeCSS(css, scopeSelector);
  //
  //   const styleTag = document.createElement('style');
  //   styleTag.setAttribute('data-pie-style', url);
  //   styleTag.textContent = scopedCSS;
  //   document.head.appendChild(styleTag);
  // }

  const player = document.getElementsByTagName('pie-player')[0];
  console.log('player', player);

  // if (player) {
  //   loadScopedExternalStyle(
  //     'https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.min.css',
  //     'pie-player.ibx-client-style'
  //   );
  // }
  player.addEventListener('ready', () => {
    console.log('ready');
  });
  player.addEventListener('loaded', () => {
    console.log('loaded');
  });

  player.addEventListener('sessionChanged', event => {
    console.log(event.type + ':' + JSON.stringify(event.detail));
  });

  player.config = config;
  player.env = { mode: 'evaluate', role: 'instructor' };
</script>
</body>
</html>
